#!/usr/bin/env bash

set -euo pipefail

pip install -r requirements.txt
npm install jupyter/configurable-http-proxy
docker pull jupyter/tmpnb

ln -s `pwd` /srv/tmpnb

chmod a+rX . -R
chmod a+x node_modules/configurable-http-proxy/bin/configurable-http-proxy

export TOKEN=$( head -c 30 /dev/urandom | xxd -p )
echo "Your TOKEN for the configurable-http-proxy is $TOKEN"

for SCRIPT in `ls script/templates`; do
  sed -e "s;%TOKEN%;$TOKEN;g" script/templates/$SCRIPT > /etc/supervisor/conf.d/$SCRIPT
done
